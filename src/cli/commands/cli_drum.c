/*
 */
#include <curses.h>
#include <unistd.h>

#include <lotto/cli/flagmgr.h>
#include <lotto/cli/subcmd.h>

#define HEIGHT 13
#define WIDTH  31

char *frames[][HEIGHT] = {
    {
        "\x20\x20\x20\x20\x20\x20\x2c\x2d\x2d\x2d\x27\x29",
        "\x20\x20\x20\x20\x20\x28\x20\x20\x2d\x5f\x2d\x28",
        "\x20\x20\x20\x20\x20\x29\x20\x2e\x5f\x5f\x2f\x20\x29",
        "\x20\x20\x20\x5f\x2f\x20\x5f\x2f\x5f\x28\x20\x2f\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x5f\x2e\x2d\x2d\x2d\x2e\x5f",
        "\x20\x20\x28\x5f\x5f\x2f\x20\x5f\x20\x5f\x29\x20\x2c\x2d\x2e\x5f\x20"
        "\x20\x20\x2f\x20\x20\x6f\x20\x20\x20\x20\x5c",
        "\x20\x20\x20\x20\x2f\x2f\x29\x5f\x5f\x28\x5c\x2f\x2c\x2d\x60\x20\x7c"
        "\x5f\x7c\x20\x4f\x20\x20\x6f\x20\x6f\x20\x4f\x7c",
        "\x5f\x5c\x5c\x2f\x2f\x2f\x3d\x3d\x6f\x3d\x5c\x27\x20\x20\x20\x20\x20"
        "\x20\x7c\x4f\x20\x6f\x20\x20\x6f\x20\x4f\x20\x7c",
        "\x20\x60\x2d\x27\x20\x5c\x20\x20\x20\x20\x2f\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x5c\x4f\x20\x6f\x20\x20\x20\x6f\x2f",
        "\x20\x20\x20\x20\x20\x20\x29\x5f\x5f\x5f\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x60\x27\x2d\x2e\x2d\x5c\x5c",
        "\x20\x20\x20\x20\x20\x2f\x20\x2c\x5c\x20\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x5f\x5f\x5f\x5f\x29\x5f\x28\x5f\x5f\x5f\x5f",
        "\x20\x20\x20\x20\x2f\x20\x2f\x20\x20\x5c\x20\x5c\x20\x20\x20\x20\x20"
        "\x27\x2d\x2d\x2e\x2e\x2d\x2d\x2d\x2c\x2c\x2d\x2d\x27",
        "\x20\x20\x20\x2f\x28\x29\x20\x20\x20\x20\x3e\x28\x29\x20\x20\x20\x20"
        "\x20\x20\x20\x20\x5c\x5c\x5f\x2f\x2f",
        "\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20"
        "\x20\x20\x20\x20\x2f\x2c\x2d\x2e\x5c",
    },
    {
        "\x20\x20\x20\x20\x20\x20\x2c\x2d\x2d\x2d\x27\x29",
        "\x20\x20\x20\x20\x20\x28\x20\x20\x2d\x5f\x2d\x28",
        "\x20\x20\x20\x20\x20\x29\x20\x2e\x5f\x5f\x2f\x20\x29",
        "\x20\x20\x20\x5f\x2f\x20\x5f\x2f\x5f\x28\x20\x2f\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x5f\x2e\x2d\x2d\x2d\x2e\x5f",
        "\x20\x20\x28\x5f\x5f\x2f\x20\x5f\x20\x5f\x29\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x2f\x20\x4f\x20\x6f\x20\x20\x4f\x5c",
        "\x20\x20\x20\x20\x2f\x2f\x29\x5f\x5f\x28\x5c\x20\x2c\x2d\x2e\x5f\x20"
        "\x5f\x7c\x4f\x20\x20\x6f\x20\x20\x4f\x20\x6f\x7c",
        "\x5f\x5c\x5c\x2f\x2f\x2f\x3d\x3d\x6f\x3d\x5c\x60\x60\x2d\x60\x20\x20"
        "\x20\x7c\x20\x20\x4f\x20\x20\x6f\x20\x20\x20\x7c",
        "\x20\x60\x2d\x27\x20\x5c\x20\x20\x20\x20\x2f\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x5c\x6f\x20\x20\x6f\x20\x20\x6f\x2f",
        "\x20\x20\x20\x20\x20\x20\x29\x5f\x5f\x5f\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x60\x27\x2d\x2e\x2d\x5c\x5c",
        "\x20\x20\x20\x20\x20\x2f\x20\x2c\x5c\x20\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x5f\x5f\x5f\x5f\x29\x5f\x28\x5f\x5f\x5f\x5f",
        "\x20\x20\x20\x20\x2f\x20\x2f\x20\x20\x5c\x20\x5c\x20\x20\x20\x20\x20"
        "\x27\x2d\x2d\x2e\x2e\x2d\x2d\x2d\x2c\x2c\x2d\x2d\x27",
        "\x20\x20\x20\x2f\x28\x29\x20\x20\x20\x20\x3e\x28\x29\x20\x20\x20\x20"
        "\x20\x20\x20\x20\x5c\x5c\x5f\x2f\x2f",
        "\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20"
        "\x20\x20\x20\x20\x2f\x2c\x2d\x2e\x5c",
    },
    {
        "\x20\x20\x20\x20\x20\x20\x2c\x2d\x2d\x2d\x27\x29",
        "\x20\x20\x20\x20\x20\x28\x20\x20\x2d\x5f\x2d\x28",
        "\x20\x20\x20\x20\x20\x29\x20\x2e\x5f\x5f\x2f\x20\x29",
        "\x20\x20\x20\x5f\x2f\x20\x5f\x2f\x5f\x28\x20\x2f\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x5f\x2e\x2d\x2d\x2d\x2e\x5f",
        "\x20\x20\x28\x5f\x5f\x2f\x20\x5f\x20\x5f\x29\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x2f\x20\x6f\x20\x6f\x20\x6f\x20\x5c",
        "\x20\x20\x20\x20\x2f\x2f\x29\x5f\x5f\x28\x5c\x20\x20\x20\x20\x20\x20"
        "\x5f\x7c\x20\x4f\x20\x4f\x20\x4f\x20\x4f\x20\x7c",
        "\x5f\x5c\x5c\x2f\x2f\x2f\x3d\x3d\x6f\x3d\x5c\x5c\x2c\x2d\x2e\x5f\x7c"
        "\x20\x7c\x4f\x20\x20\x20\x6f\x20\x20\x6f\x20\x7c",
        "\x20\x60\x2d\x27\x20\x5c\x20\x20\x20\x20\x2f\x20\x60\x2d\x60\x20\x20"
        "\x20\x20\x5c\x20\x6f\x20\x20\x20\x6f\x20\x2f",
        "\x20\x20\x20\x20\x20\x20\x29\x5f\x5f\x5f\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x60\x27\x2d\x2e\x2d\x5c\x5c",
        "\x20\x20\x20\x20\x20\x2f\x20\x2c\x5c\x20\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x5f\x5f\x5f\x5f\x29\x5f\x28\x5f\x5f\x5f\x5f",
        "\x20\x20\x20\x20\x2f\x20\x2f\x20\x20\x5c\x20\x5c\x20\x20\x20\x20\x20"
        "\x27\x2d\x2d\x2e\x2e\x2d\x2d\x2d\x2c\x2c\x2d\x2d\x27",
        "\x20\x20\x20\x2f\x28\x29\x20\x20\x20\x20\x3e\x28\x29\x20\x20\x20\x20"
        "\x20\x20\x20\x20\x5c\x5c\x5f\x2f\x2f",
        "\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20"
        "\x20\x20\x20\x20\x2f\x2c\x2d\x2e\x5c",
    },
    {
        "\x20\x20\x20\x20\x20\x20\x2c\x2d\x2d\x2d\x27\x29",
        "\x20\x20\x20\x20\x20\x28\x20\x20\x2d\x5f\x2d\x28",
        "\x20\x20\x20\x20\x20\x29\x20\x2e\x5f\x5f\x2f\x20\x29",
        "\x20\x20\x20\x5f\x2f\x20\x5f\x2f\x5f\x28\x20\x2f\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x5f\x2e\x2d\x2d\x2d\x2e\x5f",
        "\x20\x20\x28\x5f\x5f\x2f\x20\x5f\x20\x5f\x29\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x2f\x20\x6f\x20\x6f\x20\x6f\x20\x5c",
        "\x20\x20\x20\x20\x2f\x2f\x29\x5f\x5f\x28\x5c\x20\x2c\x2d\x2e\x5f\x20"
        "\x5f\x7c\x20\x4f\x20\x20\x4f\x20\x20\x6f\x20\x7c",
        "\x5f\x5c\x5c\x2f\x2f\x2f\x3d\x3d\x6f\x3d\x5c\x60\x60\x2d\x60\x20\x20"
        "\x20\x7c\x4f\x20\x4f\x20\x20\x6f\x20\x4f\x20\x7c",
        "\x20\x60\x2d\x27\x20\x5c\x20\x20\x20\x20\x2f\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x5c\x20\x6f\x20\x6f\x20\x20\x20\x2f",
        "\x20\x20\x20\x20\x20\x20\x29\x5f\x5f\x5f\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x20\x20\x60\x27\x2d\x2e\x2d\x5c\x5c",
        "\x20\x20\x20\x20\x20\x2f\x20\x2c\x5c\x20\x5c\x20\x20\x20\x20\x20\x20"
        "\x20\x5f\x5f\x5f\x5f\x29\x5f\x28\x5f\x5f\x5f\x5f",
        "\x20\x20\x20\x20\x2f\x20\x2f\x20\x20\x5c\x20\x5c\x20\x20\x20\x20\x20"
        "\x27\x2d\x2d\x2e\x2e\x2d\x2d\x2d\x2c\x2c\x2d\x2d\x27",
        "\x20\x20\x20\x2f\x28\x29\x20\x20\x20\x20\x3e\x28\x29\x20\x20\x20\x20"
        "\x20\x20\x20\x20\x5c\x5c\x5f\x2f\x2f",
        "\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20\x7c\x5c\x5f\x5c\x20\x20\x20"
        "\x20\x20\x20\x20\x2f\x2c\x2d\x2e\x5c",
    }};

#define LOTTO_SCREEN_LEN 11
#define LOTTO_SCREEN_POS 18


static int
drum(args_t *args, flags_t *flags)
{
    initscr();
    curs_set(0);
    int row, col;
    getmaxyx(stdscr, row, col);
    int srow = (row - HEIGHT) / 2;
    int scol = (col - WIDTH) / 2;
    for (int i = 0; i < 1000; i++) {
        uint8_t frame = i % (sizeof(frames) / sizeof(char **) / HEIGHT);
        for (int j = 0; j < HEIGHT; j++) {
            mvprintw(srow + j, scol, "%s\n", frames[frame][j]);
        }
        int8_t lotto_pos = LOTTO_SCREEN_LEN - 1 - (i + 8) % LOTTO_SCREEN_LEN;
        mvprintw(srow + 1, scol + LOTTO_SCREEN_POS + lotto_pos, "LOTTO ");
        if (lotto_pos > LOTTO_SCREEN_LEN - 5) {
            mvprintw(srow + 1,
                     scol + LOTTO_SCREEN_POS + lotto_pos - LOTTO_SCREEN_LEN,
                     "LOTTO ");
        }
        mvprintw(srow + 1, scol + LOTTO_SCREEN_POS + LOTTO_SCREEN_LEN, "    ");
        mvprintw(srow + 1, scol + LOTTO_SCREEN_POS - 4, "    ");
        refresh();
        usleep(500000);
    }
    endwin();
    return 0;
}

static void LOTTO_CONSTRUCTOR
init()
{
    subcmd_register(drum, "drum", "", "Lotto drum", false, (flag_t[]){0},
                    flags_default, SUBCMD_GROUP_OTHER);
}
